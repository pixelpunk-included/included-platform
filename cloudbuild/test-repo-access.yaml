# Teste de Acesso aos Reposit√≥rios
# Verifica se o Cloud Build consegue acessar os subm√≥dulos

steps:
  # Testar acesso aos reposit√≥rios
  - name: 'gcr.io/cloud-builders/git'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        echo "üîç Testando acesso aos reposit√≥rios..."
        
        echo "üìã Informa√ß√µes do ambiente:"
        echo "Working directory: $(pwd)"
        echo "Git version: $(git --version)"
        
        echo ""
        echo "üìÅ Conte√∫do atual:"
        ls -la
        
        echo ""
        echo "üìÑ Conte√∫do do .gitmodules:"
        cat .gitmodules
        
        echo ""
        echo "üîë Testando acesso ao backend:"
        git ls-remote https://github.com/pixelpunk-included/included-backend.git HEAD || echo "‚ùå Acesso negado ao backend"
        
        echo ""
        echo "üîë Testando acesso ao frontend:" 
        git ls-remote https://github.com/pixelpunk-included/included-frontend.git HEAD || echo "‚ùå Acesso negado ao frontend"
        
        echo ""
        echo "üîÑ Tentando inicializar subm√≥dulos:"
        git submodule init
        git submodule update --recursive --verbose
        
        echo ""
        echo "‚úÖ Resultado final:"
        ls -la included-backend/ 2>/dev/null && echo "‚úÖ Backend baixado com sucesso" || echo "‚ùå Backend falhou"
        ls -la included-frontend/ 2>/dev/null && echo "‚úÖ Frontend baixado com sucesso" || echo "‚ùå Frontend falhou"

# Configura√ß√µes m√≠nimas
options:
  logging: CLOUD_LOGGING_ONLY

timeout: '600s' 